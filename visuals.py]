import matplotlib.pyplot as plt
import os

def generate_charts():
    log_file = "reports/system_log.txt"
    if not os.path.exists(log_file):
        print(f"[!] Log file not found at: {log_file}")
        return

    times, cpu, ram = [], [], []
    with open(log_file, "r") as f:
        lines = f.readlines()
        for line in lines:
            try:
                parts = line.strip().split(", ")
                if len(parts) >= 3:
                    t = parts[0].split()[1].split(".")[0]
                    times.append(t)
                    cpu.append(float(parts[1]))
                    ram.append(float(parts[2]))
            except: continue

    if len(times) < 2:
        print(f"[!] Found {len(times)} data points. Need at least 2.")
        return

    plt.figure(figsize=(10, 5))
    plt.plot(times[-10:], cpu[-10:], label='CPU %', color='red', marker='o')
    plt.plot(times[-10:], ram[-10:], label='RAM %', color='blue', marker='s')
    plt.title('System Performance History')
    plt.ylabel('Percentage %')
    plt.legend()
    plt.grid(True)
    plt.savefig('reports/performance_chart.png')
    print("\n[SUCCESS] Chart saved in 'reports/performance_chart.png'")
    plt.show()
